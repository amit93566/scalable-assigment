USE inventory_db;

DROP TABLE IF EXISTS inventory;

CREATE TABLE inventory (
    inventory_id BIGINT PRIMARY KEY,
    product_id BIGINT NOT NULL,
    warehouse VARCHAR(50) NOT NULL,
    on_hand INT NOT NULL DEFAULT 0,
    reserved INT NOT NULL DEFAULT 0,
    updated_at TIMESTAMP NULL DEFAULT NULL,
    CONSTRAINT uni_product_warehouse UNIQUE (product_id, warehouse),

    INDEX idx_product_id (product_id),
    INDEX idx_warehouse (warehouse)
);

CREATE TABLE IF NOT EXISTS reservations (
  reservation_id INT AUTO_INCREMENT PRIMARY KEY,
  order_id INT NOT NULL,
  product_id INT NOT NULL,
  sku VARCHAR(50) NULL,
  warehouse VARCHAR(50) NOT NULL,
  quantity INT NOT NULL,
  idempotency_key VARCHAR(255) NOT NULL,
  reserved_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  expires_at TIMESTAMP NOT NULL,
  status ENUM('ACTIVE', 'EXPIRED', 'CONFIRMED', 'RELEASED') DEFAULT 'ACTIVE',
  INDEX idx_expires_at (expires_at, status),
  INDEX idx_order_id (order_id),
  INDEX idx_idempotency_key (idempotency_key),
  CONSTRAINT unique_order_idempotency UNIQUE (order_id, idempotency_key)
);

CREATE TABLE inventory_movements (
  movement_id INT AUTO_INCREMENT PRIMARY KEY,
  product_id INT NOT NULL,
  sku VARCHAR(50) NULL,
  warehouse VARCHAR(50) NOT NULL,
  movement_type ENUM('RESERVE', 'RELEASE', 'SHIP', 'ADJUST') NOT NULL,
  quantity INT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  reference_order_id INT NULL,
  notes TEXT
);

INSERT INTO inventory (inventory_id, product_id, warehouse, on_hand, reserved, updated_at) VALUES
(1, 1, 'WH1', 31, 0, '2023-11-02 20:05:59'),
(2, 2, 'WH1', 42, 0, '2024-04-27 19:40:56'),
(3, 3, 'WH1', 80, 0, '2023-05-31 06:12:37'),
(4, 4, 'WH1', 61, 0, '2024-11-02 00:13:25'),
(5, 5, 'WH1', 75, 0, '2024-06-03 07:42:06'),
(6, 6, 'WH2', 31, 0, '2023-06-17 12:35:27'),
(7, 7, 'WH2', 30, 0, '2024-06-13 10:01:05'),
(8, 8, 'WH1', 42, 0, '2025-03-18 06:53:23'),
(9, 9, 'WH1', 9, 0, '2025-07-21 00:18:19'),
(10, 10, 'WH2', 97, 0, '2023-05-29 14:51:50'),
(11, 11, 'WH2', 74, 0, '2023-07-13 21:51:52'),
(12, 12, 'WH2', 20, 0, '2025-06-05 06:58:20'),
(13, 13, 'WH1', 59, 0, '2025-03-24 10:29:43'),
(14, 14, 'WH1', 19, 0, '2023-10-02 18:27:14'),
(15, 15, 'WH1', 25, 0, '2025-02-09 21:49:57'),
(16, 16, 'WH2', 15, 0, '2023-09-08 17:10:45'),
(17, 17, 'WH2', 92, 0, '2023-08-25 15:37:34'),
(18, 18, 'WH2', 39, 0, '2024-06-25 04:30:17'),
(19, 19, 'WH1', 60, 0, '2024-03-26 14:15:24'),
(20, 20, 'WH1', 94, 0, '2024-06-03 00:36:58'),
(21, 21, 'WH1', 91, 0, '2024-08-16 00:27:03'),
(22, 22, 'WH2', 28, 0, '2025-03-29 02:47:04'),
(23, 23, 'WH2', 40, 0, '2023-10-21 16:11:43'),
(24, 24, 'WH2', 59, 0, '2025-06-25 00:14:19'),
(25, 25, 'WH1', 92, 0, '2024-04-09 04:10:21'),
(26, 26, 'WH1', 41, 0, '2023-11-20 23:36:15'),
(27, 27, 'WH1', 95, 0, '2024-05-24 16:35:10'),
(28, 28, 'WH1', 9, 0, '2024-05-29 00:30:26'),
(29, 29, 'WH2', 48, 0, '2024-08-14 02:29:26'),
(30, 30, 'WH1', 15, 0, '2024-01-28 20:39:27'),
(31, 31, 'WH2', 37, 0, '2024-07-16 06:17:15'),
(32, 32, 'WH2', 96, 0, '2024-03-10 03:00:54'),
(33, 33, 'WH2', 85, 0, '2025-07-20 18:31:37'),
(34, 34, 'WH1', 89, 0, '2023-09-08 04:09:59'),
(35, 35, 'WH2', 12, 0, '2025-05-30 00:57:33'),
(36, 36, 'WH2', 58, 0, '2023-07-11 11:15:35'),
(37, 37, 'WH1', 40, 0, '2024-05-01 10:14:04'),
(38, 38, 'WH1', 63, 0, '2025-04-18 20:31:00'),
(39, 39, 'WH1', 43, 0, '2024-06-03 23:29:43'),
(40, 40, 'WH1', 69, 0, '2025-07-10 13:48:07'),
(41, 41, 'WH2', 70, 0, '2024-08-01 07:11:42'),
(42, 42, 'WH2', 20, 0, '2025-01-20 16:21:40'),
(43, 43, 'WH1', 61, 0, '2024-06-18 20:18:41'),
(44, 44, 'WH1', 75, 0, '2023-05-22 04:54:15'),
(45, 45, 'WH2', 10, 0, '2023-08-14 04:31:14'),
(46, 46, 'WH2', 55, 0, '2025-05-18 10:48:42'),
(47, 47, 'WH2', 29, 0, '2023-11-20 03:52:03'),
(48, 48, 'WH1', 80, 0, '2025-03-17 16:04:14'),
(49, 49, 'WH2', 73, 0, '2025-01-27 10:18:14'),
(50, 50, 'WH1', 73, 0, '2025-03-24 16:47:18'),
(51, 51, 'WH1', 77, 0, '2024-06-10 20:41:00'),
(52, 52, 'WH2', 33, 0, '2023-08-25 08:35:46'),
(53, 53, 'WH1', 19, 0, '2023-12-07 19:33:04'),
(54, 54, 'WH2', 17, 0, '2024-03-01 10:14:04'),
(55, 55, 'WH2', 59, 0, '2024-11-04 11:27:36'),
(56, 56, 'WH1', 37, 0, '2024-01-08 01:14:50'),
(57, 57, 'WH1', 62, 0, '2024-04-03 20:17:09'),
(58, 58, 'WH2', 79, 0, '2023-08-16 23:27:07'),
(59, 59, 'WH2', 29, 0, '2024-03-16 11:15:35'),
(60, 60, 'WH2', 65, 0, '2025-03-16 02:44:03'),
(61, 61, 'WH1', 35, 0, '2023-09-17 07:44:09'),
(62, 62, 'WH2', 77, 0, '2024-09-19 14:14:56'),
(63, 63, 'WH1', 50, 0, '2024-05-19 12:47:23'),
(64, 64, 'WH1', 15, 0, '2024-10-02 21:05:32'),
(65, 65, 'WH2', 74, 0, '2024-01-13 14:48:35'),
(66, 66, 'WH1', 48, 0, '2024-02-28 11:29:43'),
(67, 67, 'WH1', 39, 0, '2024-08-01 19:04:19'),
(68, 68, 'WH1', 68, 0, '2025-02-14 17:39:13'),
(69, 69, 'WH1', 22, 0, '2024-06-25 09:12:08'),
(70, 70, 'WH1', 48, 0, '2023-11-26 14:53:57'),
(71, 71, 'WH1', 57, 0, '2024-05-02 01:05:01'),
(72, 72, 'WH2', 79, 0, '2024-02-17 19:09:05'),
(73, 73, 'WH1', 82, 0, '2023-09-10 16:32:00'),
(74, 74, 'WH1', 88, 0, '2025-03-10 03:00:54'),
(75, 75, 'WH2', 15, 0, '2025-02-26 09:27:35'),
(76, 76, 'WH1', 40, 0, '2024-05-06 05:22:23'),
(77, 77, 'WH1', 43, 0, '2024-07-28 16:40:48'),
(78, 78, 'WH1', 10, 0, '2023-10-18 10:20:49'),
(79, 79, 'WH2', 20, 0, '2025-03-17 01:42:34'),
(80, 80, 'WH2', 22, 0, '2024-05-14 22:26:09'),
(81, 81, 'WH2', 67, 0, '2025-01-20 18:37:12'),
(82, 82, 'WH2', 60, 0, '2024-02-21 20:16:15'),
(83, 83, 'WH2', 81, 0, '2025-06-26 04:27:00'),
(84, 84, 'WH1', 26, 0, '2023-12-08 00:31:58'),
(85, 85, 'WH1', 57, 0, '2023-12-31 02:29:27'),
(86, 86, 'WH2', 27, 0, '2024-04-20 08:28:15'),
(87, 87, 'WH2', 48, 0, '2025-06-06 14:13:55'),
(88, 88, 'WH1', 47, 0, '2024-01-31 09:32:16'),
(89, 89, 'WH1', 17, 0, '2023-05-11 12:47:47'),
(90, 90, 'WH2', 56, 0, '2025-02-13 14:59:04'),
(91, 91, 'WH2', 36, 0, '2024-01-21 02:26:02'),
(92, 92, 'WH2', 35, 0, '2025-03-24 07:14:48'),
(93, 93, 'WH1', 94, 0, '2024-11-06 00:34:04'),
(94, 94, 'WH1', 82, 0, '2024-05-24 16:35:10'),
(95, 95, 'WH1', 16, 0, '2023-06-01 10:14:46'),
(96, 96, 'WH1', 63, 0, '2024-11-03 16:32:55'),
(97, 97, 'WH1', 69, 0, '2023-06-03 14:55:08'),
(98, 98, 'WH1', 51, 0, '2025-01-13 14:52:19'),
(99, 99, 'WH2', 88, 0, '2024-10-14 20:00:26'),
(100, 100, 'WH1', 41, 0, '2024-03-08 19:15:31'),
(101, 101, 'WH1', 80, 0, '2024-09-20 04:30:17'),
(102, 102, 'WH1', 77, 0, '2025-01-09 21:05:32'),
(103, 103, 'WH2', 62, 0, '2025-02-23 03:03:09'),
(104, 104, 'WH1', 99, 0, '2024-09-27 10:18:14'),
(105, 105, 'WH1', 88, 0, '2024-07-29 02:29:26'),
(106, 106, 'WH2', 39, 0, '2024-10-23 16:29:57'),
(107, 107, 'WH2', 26, 0, '2024-07-16 06:17:15'),
(108, 108, 'WH2', 62, 0, '2024-09-22 09:12:08'),
(109, 109, 'WH2', 76, 0, '2025-05-18 10:48:42'),
(110, 110, 'WH2', 56, 0, '2023-08-25 15:37:34'),
(111, 111, 'WH1', 59, 0, '2025-06-06 14:13:55'),
(112, 112, 'WH2', 96, 0, '2023-11-20 03:52:03'),
(113, 113, 'WH2', 90, 0, '2024-05-06 05:22:23'),
(114, 114, 'WH2', 45, 0, '2024-03-01 10:14:04'),
(115, 115, 'WH2', 78, 0, '2023-10-02 18:27:14'),
(116, 116, 'WH2', 36, 0, '2023-05-22 04:54:15'),
(117, 117, 'WH2', 52, 0, '2024-06-18 20:18:41'),
(118, 118, 'WH1', 75, 0, '2025-03-29 02:47:04'),
(119, 119, 'WH1', 77, 0, '2024-01-28 20:39:27'),
(120, 120, 'WH1', 52, 0, '2025-07-20 18:31:37');

SELECT 'Total rows inserted:', COUNT(*) FROM inventory;
SELECT * FROM inventory LIMIT 10;

